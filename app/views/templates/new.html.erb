<% content_for :head do %>
  <meta name="description" content="Create stunning templates with our advanced drag-and-drop builder. Design emails, websites, SEO content, and social media posts with ease.">
  <style>
    .template-builder {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }

    /* Enhanced drag and drop animations */
    .drag-item {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border-radius: 1rem;
      backdrop-filter: blur(10px);
    }

    .drag-item:hover {
      transform: translateY(-4px) scale(1.02);
      box-shadow: 0 20px 40px rgba(139, 92, 246, 0.2);
    }

    /* Improved drop zone with gradient borders */
    .drop-zone {
      min-height: 200px;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      border-radius: 1.5rem;
      background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
      backdrop-filter: blur(20px);
    }

    .drop-zone.drag-over {
      background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);
      border: none;
      box-shadow: 0 0 40px rgba(139, 92, 246, 0.4);
      transform: scale(1.02);
    }

    /* Enhanced component palette with glassmorphism */
    .component-palette {
      background: linear-gradient(135deg, rgba(248, 250, 252, 0.8) 0%, rgba(241, 245, 249, 0.9) 100%);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    /* Canvas area with subtle gradient */
    .canvas-area {
      background: linear-gradient(135deg, #fafbff 0%, #f1f5f9 50%, #e2e8f0 100%);
    }

    /* Floating toolbar with enhanced glassmorphism */
    .floating-toolbar {
      backdrop-filter: blur(20px);
      background: rgba(255, 255, 255, 0.95);
      border: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    /* Enhanced glow effect */
    .glow-effect {
      box-shadow: 0 0 40px rgba(139, 92, 246, 0.3), 0 0 80px rgba(236, 72, 153, 0.2);
    }

    /* Template type cards with improved gradients */
    .template-type-card {
      background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      border-radius: 1.5rem;
      border: none;
      backdrop-filter: blur(10px);
    }

    .template-type-card:hover {
      transform: translateY(-8px) scale(1.05);
      box-shadow: 0 25px 50px rgba(139, 92, 246, 0.3);
    }

    /* AI assistant with enhanced gradient */
    .ai-assistant {
      background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 50%, #fecfef 100%);
      border-radius: 1.5rem;
      border: none;
      backdrop-filter: blur(10px);
    }

    /* Smooth page transitions */
    .page-transition {
      animation: fadeInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Enhanced responsive design */
    @media (max-width: 1024px) {
      .template-builder {
        flex-direction: column;
      }

      .canvas-area {
        order: 1;
      }
    }

    @media (max-width: 768px) {
      .template-type-card {
        border-radius: 1rem;
        padding: 1rem;
      }

      .drag-item {
        border-radius: 0.75rem;
        padding: 0.75rem;
      }

      .drop-zone {
        min-height: 150px;
        border-radius: 1rem;
        padding: 2rem;
      }

      .floating-toolbar {
        position: fixed;
        bottom: 1rem;
        right: 1rem;
        top: auto;
        padding: 0.75rem;
      }

      .floating-toolbar .flex {
        flex-wrap: wrap;
        gap: 0.5rem;
      }
    }

    @media (max-width: 640px) {
      .template-builder {
        min-height: 100vh;
      }

      .drop-zone {
        padding: 1.5rem;
      }

      .floating-toolbar {
        bottom: 0.5rem;
        right: 0.5rem;
        left: 0.5rem;
        width: auto;
      }
    }

    /* Interactive feedback animations */
    .interactive-feedback {
      animation: pulse-glow 2s ease-in-out infinite;
    }

    @keyframes pulse-glow {
      0%, 100% {
        box-shadow: 0 0 20px rgba(139, 92, 246, 0.3);
      }
      50% {
        box-shadow: 0 0 40px rgba(139, 92, 246, 0.6);
      }
    }

    /* Loading states */
    .loading-shimmer {
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
    }

    @keyframes shimmer {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }
  </style>
<% end %>

<div class="template-builder min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100 page-transition">
  <!-- Enhanced Header with Glassmorphism -->
  <div class="bg-white/90 backdrop-blur-xl border-none sticky top-0 z-50 shadow-lg shadow-purple-500/10">
    <div class="max-w-7xl mx-auto px-6 sm:px-8 lg:px-12">
      <div class="flex items-center justify-between h-20">
        <div class="flex items-center space-x-6">
          <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-500 rounded-2xl flex items-center justify-center shadow-lg shadow-purple-500/30 transform hover:scale-105 transition-all duration-300">
            <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zM21 5a2 2 0 00-2-2h-4a2 2 0 00-2 2v12a4 4 0 004 4h4a2 2 0 002-2V5z"></path>
            </svg>
          </div>
          <div>
            <h1 class="text-2xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">Template Builder</h1>
            <p class="text-sm text-gray-600 font-medium">Create stunning content with AI-powered design</p>
          </div>
        </div>

        <div class="flex items-center space-x-4">
          <!-- Mobile Menu Button -->
          <button onclick="toggleMobileNav()" class="lg:hidden p-3 text-gray-600 hover:text-purple-600 rounded-2xl hover:bg-purple-50 transition-all duration-300">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
            </svg>
          </button>

          <!-- Desktop Action Buttons -->
          <div class="hidden md:flex items-center space-x-3">
            <button class="px-6 py-3 text-sm font-semibold text-gray-700 bg-white/80 backdrop-blur-sm rounded-2xl hover:bg-white hover:shadow-lg hover:shadow-gray-200/50 transition-all duration-300 border border-gray-200/50">
              <span class="flex items-center space-x-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                </svg>
                <span>Preview</span>
              </span>
            </button>
            <button class="px-6 py-3 text-sm font-semibold text-white bg-gradient-to-r from-purple-600 to-pink-600 rounded-2xl hover:from-purple-700 hover:to-pink-700 hover:shadow-lg hover:shadow-purple-500/30 transition-all duration-300 transform hover:scale-105">
              <span class="flex items-center space-x-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3-3m0 0l-3 3m3-3v12"></path>
                </svg>
                <span>Save Template</span>
              </span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="flex h-screen">
    <!-- Enhanced Template Type Selector -->
    <div class="w-80 lg:w-96 bg-white/95 backdrop-blur-xl border-none overflow-y-auto shadow-xl shadow-purple-500/5" data-controller="template-selector">
      <div class="p-8">
        <div class="mb-8">
          <h2 class="text-2xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent mb-2">Choose Template Type</h2>
          <p class="text-gray-600 text-sm font-medium">Select the type of content you want to create</p>
        </div>

        <div class="space-y-4">
          <div class="template-type-card p-6 text-white cursor-pointer group focus:outline-none focus:ring-4 focus:ring-white/50"
               data-type="email"
               data-action="click->template-selector#selectType"
               role="button"
               tabindex="0"
               aria-label="Select Email Templates - Create newsletters, promotions, and transactional emails"
               onkeydown="if(event.key === 'Enter' || event.key === ' ') { event.preventDefault(); this.click(); }">
            <div class="flex items-center space-x-4">
              <div class="w-12 h-12 bg-white/20 rounded-2xl flex items-center justify-center group-hover:bg-white/30 transition-all duration-300" aria-hidden="true">
                <svg class="w-7 h-7" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
                </svg>
              </div>
              <div class="flex-1">
                <h3 class="font-bold text-lg">ðŸ“§ Email Templates</h3>
                <p class="text-sm opacity-90 font-medium">Create newsletters, promotions, and transactional emails</p>
              </div>
              <div class="w-6 h-6 bg-white/20 rounded-full flex items-center justify-center group-hover:bg-white/30 transition-all duration-300" aria-hidden="true">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
              </div>
            </div>
          </div>
          
          <div class="template-type-card p-4 rounded-xl text-white cursor-pointer" data-type="website" data-action="click->template-selector#selectType" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%)">
            <div class="flex items-center space-x-3">
              <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24">
                <path d="M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zM4 6h16v2H4V6zm0 4h4v8H4v-8zm6 0h10v8H10v-8z"/>
              </svg>
              <div>
                <h3 class="font-semibold">Website Pages</h3>
                <p class="text-sm opacity-90">Landing pages, product pages, blogs</p>
              </div>
            </div>
          </div>
          
          <div class="template-type-card p-4 rounded-xl text-white cursor-pointer" data-type="facebook" data-action="click->template-selector#selectType" style="background: linear-gradient(135deg, #1877f2 0%, #42a5f5 100%)">
            <div class="flex items-center space-x-3">
              <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24">
                <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
              </svg>
              <div>
                <h3 class="font-semibold">Facebook</h3>
                <p class="text-sm opacity-90">Posts, ads, cover photos, stories</p>
              </div>
            </div>
          </div>
          
          <div class="template-type-card p-4 rounded-xl text-white cursor-pointer" data-type="instagram" data-action="click->template-selector#selectType" style="background: linear-gradient(135deg, #833ab4 0%, #fd1d1d 50%, #fcb045 100%)">
            <div class="flex items-center space-x-3">
              <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
              </svg>
              <div>
                <h3 class="font-semibold">Instagram</h3>
                <p class="text-sm opacity-90">Posts, stories, reels, IGTV</p>
              </div>
            </div>
          </div>
          
          <div class="template-type-card p-4 rounded-xl text-white cursor-pointer" data-type="seo" data-action="click->template-selector#selectType" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%)">
            <div class="flex items-center space-x-3">
              <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24">
                <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
              </svg>
              <div>
                <h3 class="font-semibold">SEO Content</h3>
                <p class="text-sm opacity-90">Meta descriptions, titles, schemas</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Enhanced AI Assistant -->
        <div class="ai-assistant mt-8 p-6">
          <div class="flex items-center space-x-4 mb-4">
            <div class="w-12 h-12 bg-white/20 rounded-2xl flex items-center justify-center">
              <svg class="w-7 h-7 text-white" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
              </svg>
            </div>
            <div>
              <h3 class="font-bold text-white text-lg">AI Assistant</h3>
              <p class="text-white/80 text-sm font-medium">Powered by advanced AI</p>
            </div>
          </div>
          <p class="text-white/90 text-sm mb-6 leading-relaxed">Let AI help you create the perfect template with intelligent suggestions and automated design</p>
          <button class="w-full px-4 py-3 bg-white/20 text-white rounded-2xl text-sm font-semibold hover:bg-white/30 transition-all duration-300 transform hover:scale-105 backdrop-blur-sm">
            <span class="flex items-center justify-center space-x-2">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
              </svg>
              <span>Generate with AI</span>
            </span>
          </button>
        </div>
      </div>
    </div>

    <!-- Enhanced Component Palette -->
    <div class="w-72 lg:w-80 component-palette border-none overflow-y-auto shadow-xl shadow-purple-500/5" data-controller="component-palette">
      <div class="p-8">
        <div class="mb-8">
          <h3 class="text-2xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent mb-2">Components</h3>
          <p class="text-gray-600 text-sm font-medium">Drag and drop to build your template</p>
        </div>

        <!-- Enhanced Search -->
        <div class="relative mb-8">
          <input type="text" placeholder="Search components..." class="w-full pl-12 pr-4 py-4 text-sm bg-white/80 backdrop-blur-sm rounded-2xl focus:ring-2 focus:ring-purple-500 focus:bg-white border-none shadow-lg shadow-gray-200/50 transition-all duration-300 placeholder-gray-500" data-component-palette-target="search" data-action="input->component-palette#handleSearch">
          <div class="absolute left-4 top-1/2 transform -translate-y-1/2">
            <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
          </div>
        </div>

        <!-- Enhanced Component Categories -->
        <div class="space-y-6" data-component-palette-target="categories">
          <!-- Dynamic Component Categories -->
          <div class="text-center text-gray-500 py-12 bg-white/50 backdrop-blur-sm rounded-2xl border border-gray-200/50">
            <div class="w-16 h-16 bg-gradient-to-br from-purple-100 to-pink-100 rounded-2xl flex items-center justify-center mx-auto mb-4">
              <svg class="w-8 h-8 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zM21 5a2 2 0 00-2-2h-4a2 2 0 00-2 2v12a4 4 0 004 4h4a2 2 0 002-2V5z"></path>
              </svg>
            </div>
            <p class="font-medium">Select a template type to see available components</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Canvas Area -->
    <div class="flex-1 canvas-area overflow-auto" data-controller="template-canvas">
      <div class="p-6">
        <!-- Floating Toolbar -->
        <div class="floating-toolbar fixed top-20 right-6 z-40 p-3 rounded-xl border border-gray-200 shadow-lg">
          <div class="flex items-center space-x-2">
            <button class="p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors" title="Undo">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"></path>
              </svg>
            </button>
            <button class="p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors" title="Redo">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 10h-10a8 8 0 00-8 8v2m18-10l-6 6m6-6l-6-6"></path>
              </svg>
            </button>
            <div class="w-px h-6 bg-gray-300"></div>
            <button class="p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors" title="Mobile View">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
              </svg>
            </button>
            <button class="p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors" title="Desktop View">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
              </svg>
            </button>
          </div>
        </div>
        
        <!-- Canvas -->
        <div class="max-w-4xl mx-auto">
          <div class="bg-white rounded-xl shadow-lg border border-gray-200 min-h-96 glow-effect" data-canvas="true">
            <!-- Drop Zone -->
            <div class="drop-zone p-8 rounded-xl border-2 border-dashed border-gray-300 text-center" data-target="template-canvas.dropZone">
              <div class="max-w-sm mx-auto">
                <svg class="w-16 h-16 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                </svg>
                <h3 class="text-lg font-semibold text-gray-900 mb-2">Start Building Your Template</h3>
                <p class="text-gray-600 mb-4">Drag components from the left panel to start creating your template</p>
                <div class="flex flex-wrap gap-2 justify-center">
                  <span class="px-3 py-1 bg-purple-100 text-purple-800 text-xs font-medium rounded-full">Drag & Drop</span>
                  <span class="px-3 py-1 bg-blue-100 text-blue-800 text-xs font-medium rounded-full">AI Powered</span>
                  <span class="px-3 py-1 bg-green-100 text-green-800 text-xs font-medium rounded-full">Responsive</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Properties Panel -->
    <div class="w-80 bg-white/90 backdrop-blur-sm border-l border-gray-200 overflow-y-auto" data-controller="properties-panel">
      <div class="p-6">
        <h3 class="font-semibold text-gray-900 mb-4">Properties</h3>
        
        <div class="space-y-6">
          <!-- Template Settings -->
          <div>
            <h4 class="text-sm font-medium text-gray-700 mb-3">Template Settings</h4>
            <div class="space-y-3">
              <div>
                <label class="block text-xs font-medium text-gray-600 mb-1">Template Name</label>
                <input type="text" class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="My Awesome Template">
              </div>
              <div>
                <label class="block text-xs font-medium text-gray-600 mb-1">Description</label>
                <textarea class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" rows="3" placeholder="Template description..."></textarea>
              </div>
            </div>
          </div>
          
          <!-- Style Settings -->
          <div>
            <h4 class="text-sm font-medium text-gray-700 mb-3">Global Styles</h4>
            <div class="space-y-3">
              <div>
                <label class="block text-xs font-medium text-gray-600 mb-1">Primary Color</label>
                <div class="flex space-x-2">
                  <input type="color" value="#8B5CF6" class="w-12 h-8 border border-gray-300 rounded cursor-pointer">
                  <input type="text" value="#8B5CF6" class="flex-1 px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                </div>
              </div>
              <div>
                <label class="block text-xs font-medium text-gray-600 mb-1">Font Family</label>
                <select class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                  <option>Inter</option>
                  <option>Roboto</option>
                  <option>Open Sans</option>
                  <option>Lato</option>
                </select>
              </div>
            </div>
          </div>
          
          <!-- Component Properties -->
          <div data-target="properties-panel.componentProps" class="hidden">
            <h4 class="text-sm font-medium text-gray-700 mb-3">Component Properties</h4>
            <div class="text-sm text-gray-500">Select a component to edit its properties</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Hidden Form for Persistence -->
<%= form_with model: @template, local: true, class: "hidden", data: { target: "template-canvas.form" } do |form| %>
  <%= form.hidden_field :name, data: { target: "template-canvas.nameField" } %>
  <%= form.hidden_field :template_type, data: { target: "template-canvas.typeField" } %>
  <%= form.hidden_field :body, data: { target: "template-canvas.bodyField" } %>
  <%= form.hidden_field :subject, data: { target: "template-canvas.subjectField" } %>
  <%= form.hidden_field :description, data: { target: "template-canvas.descriptionField" } %>
<% end %>

<script>
  // Mobile Navigation Functions
  function toggleMobileNav() {
    const overlay = document.getElementById('mobile-nav-overlay');
    const panel = document.getElementById('mobile-nav-panel');

    if (overlay.classList.contains('hidden')) {
      overlay.classList.remove('hidden');
      setTimeout(() => {
        panel.classList.remove('-translate-x-full');
      }, 10);
    } else {
      panel.classList.add('-translate-x-full');
      setTimeout(() => {
        overlay.classList.add('hidden');
      }, 300);
    }
  }

  // Initialize drag and drop functionality
  document.addEventListener('DOMContentLoaded', function() {
    // Add drag and drop event listeners
    const dragItems = document.querySelectorAll('.drag-item');
    const dropZone = document.querySelector('.drop-zone');
    
    dragItems.forEach(item => {
      item.addEventListener('dragstart', function(e) {
        e.dataTransfer.setData('text/plain', this.dataset.component);
        this.style.opacity = '0.5';
      });
      
      item.addEventListener('dragend', function(e) {
        this.style.opacity = '1';
      });
    });
    
    if (dropZone) {
      dropZone.addEventListener('dragover', function(e) {
        e.preventDefault();
        this.classList.add('drag-over');
      });
      
      dropZone.addEventListener('dragleave', function(e) {
        this.classList.remove('drag-over');
      });
      
      dropZone.addEventListener('drop', function(e) {
        e.preventDefault();
        this.classList.remove('drag-over');
        
        const componentType = e.dataTransfer.getData('text/plain');
        addComponent(componentType, this);
      });
    }
    
    function addComponent(type, container) {
      const componentHTML = generateComponentHTML(type);
      const wrapper = document.createElement('div');
      wrapper.className = 'component-wrapper mb-4 p-4 border border-gray-200 rounded-lg hover:border-purple-500 transition-colors';
      wrapper.innerHTML = componentHTML;
      
      // Replace the drop zone content or append to existing content
      if (container.querySelector('svg')) {
        container.innerHTML = '';
        container.className = 'drop-zone p-4';
      }
      
      container.appendChild(wrapper);
      
      // Add delete button
      const deleteBtn = document.createElement('button');
      deleteBtn.className = 'absolute top-2 right-2 w-6 h-6 bg-red-500 text-white rounded-full text-xs hover:bg-red-600 transition-colors';
      deleteBtn.innerHTML = 'Ã—';
      deleteBtn.onclick = () => wrapper.remove();
      wrapper.style.position = 'relative';
      wrapper.appendChild(deleteBtn);
    }
    
    function generateComponentHTML(type) {
      // This function will be handled by the template-canvas controller
      // which uses dynamic component definitions from template_components.js
      return '<div class="p-4 text-center text-gray-500">Component will be rendered dynamically</div>';
    }
  });
</script>